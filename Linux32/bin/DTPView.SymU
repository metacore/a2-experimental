MODULE DTPView;
	IMPORT WMStandardComponents, WMGraphics, Inputs, WMComponents, WMRectangles, WMEditors, Strings, WMWindowManager, DTPData, DTPUtilities;
CONST 
	RULERSIZE = 20; 
	HIGHLIGHT = SIGNED32(4287103231); 
	ACTIVEFRAMECOLOR = 65535; 
	FRAMECOLOR = 8978431; 
	MASTERFRAMECOLOR = 16746751; 
	BORDERCOLOR = SIGNED32(4278255615); 
	GUIDECOLOR = 16777215; 
	GRIDCOLOR = SIGNED32(3132799743); 
	SUBGRIDCOLOR = SIGNED32(3722305023); 
	point = 3.527777778E-1; 
TYPE 
	DrawPanel* = OBJECT {EXCLUSIVE} (WMComponents.VisualComponent)
	VAR 
		document: DTPData.Document; 
		cpage: DTPData.PageObject; 
		cframe, activeFrame*: DTPData.FrameObject; 
		cguide: DTPData.GuideObject; 
		ccontent: DTPData.ContentObject; 
		ready*: BOOLEAN; 
		vScrollbar-: WMStandardComponents.Scrollbar; 
		hScrollbar-: WMStandardComponents.Scrollbar; 
		zoomFactor: FLOAT32; 
		quality: BOOLEAN; 
		zoomUser: FLOAT32; 
		zoomMode-: SIGNED32; 
		docOriginX, docOriginY: SIGNED32; 
		snapDistance: FLOAT32; 
		showGrid, snapToGrid: BOOLEAN; 
		gridDistance: FLOAT32; 
		gridDivision: SIGNED32; 
		wheelMode-: SIGNED32; 
		previewMode*: BOOLEAN; 
		mpageMode*: BOOLEAN; 
		render: BOOLEAN; 
		selectionON*: BOOLEAN; 
		snapOnCreate: BOOLEAN; 
		activeTool*: Strings.String; 
		x0, y0, x1, y1, dx, dy, gx, gy, vx0, vy0, vx1, vy1: SIZE; 
		fx0, fy0, fx1, fy1, tx0, ty0, tx1, ty1: FLOAT32; 
		res, res2: SIGNED32; 
		down, move, resize, addobject, addguide, moveguide, oldpointer: BOOLEAN; 
		prevPointerInfo: WMWindowManager.PointerInfo; 
		oldPointerInfo: SIGNED32; 
		plugPointer: BOOLEAN; 
		manager: WMWindowManager.WindowManager; 
		oldfx0, oldfy0, oldfx1, oldfy1: FLOAT32; 
		props*: PropertyWindow; 
		propertyOpen*: BOOLEAN; 
		propsX*, propsY*: SIZE; 
		newPluginObject*: PROCEDURE {DELEGATE}():DTPData.ContentObject; 
		ownerWindowSetFocus*: PROCEDURE {DELEGATE}; 
		ownerWindowUpdatePageNumber*: PROCEDURE {DELEGATE}; 
		ownerWindowExitFullScreen*: PROCEDURE {DELEGATE}; 

		PROCEDURE ^  & Init*; 
		PROCEDURE ^ PropertyChanged*(sender, property: ANY); 
		PROCEDURE ^ Resized*; 
		PROCEDURE ^ Render*(state: BOOLEAN); 
		PROCEDURE ^ RecacheProperties*; 
		PROCEDURE ^ SetScrollbars*(hScrollbar, vScrollbar: WMStandardComponents.Scrollbar); 
		PROCEDURE ^ ScrollbarsChanged*(sender, data: ANY); 
		PROCEDURE ^ UpdateScrollbars; 
		PROCEDURE ^ SetDocument*(doc: DTPData.Document); 
		PROCEDURE ^ GetDocument*(): DTPData.Document; 
		PROCEDURE ^ SetZoomMode*(mode: SIGNED32); 
		PROCEDURE ^ SetRenderZoomMode*(mode: SIGNED32); 
		PROCEDURE ^ ZoomFitHeight*; 
		PROCEDURE ^ ZoomFitWidth*; 
		PROCEDURE ^ ZoomFitDoc*; 
		PROCEDURE ^ ZoomFitFrame*; 
		PROCEDURE ^ ZoomFitUser*; 
		PROCEDURE ^ ZoomFitOriginal*; 
		PROCEDURE ^ ZoomIncrease*; 
		PROCEDURE ^ ZoomDecrease*; 
		PROCEDURE ^ SetZoomUser*(factor: FLOAT32); 
		PROCEDURE ^ SetZoomFactor*(factor: FLOAT32); 
		PROCEDURE ^ GetZoomFactor*(): FLOAT32; 
		PROCEDURE ^ SetOrigin*(x, y: SIGNED32); 
		PROCEDURE ^ GetOriginX*(): SIGNED32; 
		PROCEDURE ^ GetOriginY*(): SIGNED32; 
		PROCEDURE ^ SetSnapDistance*(distance: FLOAT32); 
		PROCEDURE ^ GetSnapDistance*(): FLOAT32; 
		PROCEDURE ^ SetSnap*(s2grid: BOOLEAN); 
		PROCEDURE ^ GetSnap*(): BOOLEAN; 
		PROCEDURE ^ SetPreviewMode*(prevMode: BOOLEAN); 
		PROCEDURE ^ GetPreviewMode*(): BOOLEAN; 
		PROCEDURE ^ SetMasterEditMode*(masterMode: BOOLEAN); 
		PROCEDURE ^ GetMasterEditMode*(): BOOLEAN; 
		PROCEDURE ^ ShowGrid*(sGrid: BOOLEAN); 
		PROCEDURE ^ SetGrid*(gDist: FLOAT32; gDiv: SIGNED32); 
		PROCEDURE ^ WheelMove*(dz: SIZE); 
		PROCEDURE ^ PointerDown*(x, y: SIZE; keys: SET); 
		PROCEDURE ^ PointerMove*(x, y: SIZE; keys: SET); 
		PROCEDURE ^ PointerUp*(x, y: SIZE; keys: SET); 
		PROCEDURE ^ KeyEvent*(ucs: SIZE; flags: SET; VAR keySym: SIZE); 
		PROCEDURE ^ WillSnap*(sx, sy, ex, ey: FLOAT32; VAR leftSnap, topSnap, rightSnap, bottomSnap: BOOLEAN; VAR resX, resY: FLOAT32): BOOLEAN; 
		PROCEDURE ^ IsInRuler*(x, y: SIZE): SIGNED32; 
		PROCEDURE ^ IsInFrameHandle*(x, y: SIZE): SIGNED32; 
		PROCEDURE ^ Draw*(canvas: WMGraphics.Canvas); 
		PROCEDURE ^ DrawRuler(canvas: WMGraphics.Canvas); 
		PROCEDURE ^ DrawDocument*(canvas: WMGraphics.Canvas); 
		PROCEDURE ^ DrawGrid(canvas: WMGraphics.Canvas); 
		PROCEDURE ^ DrawHelpers(canvas: WMGraphics.Canvas); 
		PROCEDURE ^ DrawContent*(canvas: WMGraphics.Canvas); 
		PROCEDURE ^ DrawSelectedFrame(canvas: WMGraphics.Canvas); 
		PROCEDURE ^ DrawRectangle(canvas: WMGraphics.Canvas; xs, ys, xe, ye, color: SIGNED32); 
		PROCEDURE ^ DrawFrameHandles(canvas: WMGraphics.Canvas; xs, ys, xe, ye, color: SIGNED32); 
		PROCEDURE ^ DrawUserAction(canvas: WMGraphics.Canvas); 
		PROCEDURE ^ InvalidateCurrentFrame*; 
		PROCEDURE ^ SetContentPropsPosition*(x, y: SIZE); 
		PROCEDURE ^ UpdateContentProps*; 
		PROCEDURE ^ UpdateProps*; 
		PROCEDURE ^ UpdateCoordinates*; 
		PROCEDURE ^ CloseContentProps*; 
	END DrawPanel; 

	PropertyWindow* = OBJECT {EXCLUSIVE} (WMComponents.FormWindow)
	VAR 
		frameName: Strings.String; 
		frameX, frameY, frameW, frameH: FLOAT32; 
		frameStyle: DTPData.StyleObject; 
		textwrapON: BOOLEAN; 
		twrapTop, twrapBottom, twrapLeft, twrapRight: FLOAT32; 
		theCaller: DrawPanel; 
		tempLabel*: WMStandardComponents.Label; 
		cdoc: DTPData.Document; 
		cpage: DTPData.PageObject; 
		cframe: DTPData.FrameObject; 
		cguide: DTPData.GuideObject; 
		shown, active, activeALL: BOOLEAN; 
		leftPanel, rightPanel: WMStandardComponents.Panel; 
		efx, efy, efw, efh, efn, efs, eftw, efwt, efwb, efwl, efwr: WMEditors.Editor; 

		PROCEDURE ^  & New*(caller: DrawPanel); 
		PROCEDURE ^ CreatePropertyForm(): WMComponents.VisualComponent; 
		PROCEDURE ^ Show*; 
		PROCEDURE ^ Hide*; 
		PROCEDURE ^ SetActiveALL*; 
		PROCEDURE ^ SetActive*; 
		PROCEDURE ^ SetInactive*; 
		PROCEDURE ^ SetProperties*(x, y, w, h: FLOAT32; name: Strings.String; style: DTPData.StyleObject; tw: BOOLEAN; twt, twb, twl, twr: FLOAT32); 
		PROCEDURE ^ SetCoordinates*(x, y, w, h: FLOAT32); 
		PROCEDURE ^ InitValues*; 
		PROCEDURE ^ SetValueHandler(sender, data: ANY); 
		PROCEDURE ^ Close*; 
	END PropertyWindow; 
BEGIN
END DTPView.
