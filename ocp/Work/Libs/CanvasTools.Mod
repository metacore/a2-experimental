MODULE CanvasTools;	(** AUTHOR "BohdanT"; PURPOSE "Canvas extension tools"; *)IMPORT WMGraphics, WMRectangles,  Raster,BIT;CONSTsc = (*sincos table for draw circle*)[[1.00000000,0.00000000],[0.99518473,0.09801714],[0.98078528,0.19509033],[0.95694034,0.29028468],[0.92387953,0.38268344],[0.88192125,0.47139676],[0.83146961,0.55557023],[0.77301043,0.63439332]]; PROCEDURE CreatePen*(size,color:LONGINT;VAR image: Raster.Image);VAR i : LONGINT;	p : ARRAY 64 OF WMGraphics.Point2d;	r,x,y:REAL;	c:WMGraphics.BufferCanvas;BEGIN	NEW(image);	Raster.Create(image, size, size, Raster.BGRA8888);	NEW(c,image);	c.Fill(WMRectangles.MakeRect(0, 0, size, size),0,WMGraphics.ModeCopy);	r:=size / 2;	FOR i := 0 TO 8-1 DO 		x := r *sc[i,0];		y := r * sc[i,1];				p[i].x := ENTIER(r + x+0.5);		p[i].y := ENTIER(r + y+0.5);		p[15-i].x := ENTIER(r +y+0.5 );		p[15-i].y := ENTIER(r +x+0.5 );		p[16+i].x := ENTIER(r -y+0.5 );		p[16+i].y := ENTIER(r +x+0.5 );		p[31-i].x := ENTIER(r - x+0.5);		p[31-i].y := ENTIER(r +y +0.5);(**************)		p[32+i].x := ENTIER(r - x+0.5);		p[32+i].y := ENTIER(r - y+0.5);		p[47-i].x := ENTIER(r -y+0.5) ;		p[47-i].y := ENTIER(r - x+0.5);		p[i+48].x := ENTIER(r +y+0.5) ;		p[i+48].y := ENTIER(r -x+0.5) ;		p[63-i].x := ENTIER(r +x+0.5) ;		p[63-i].y := ENTIER(r -y+0.5 );	END;	c.FillPolygonFlat(p, 64, color, WMGraphics.ModeCopy);END CreatePen;(** draw a line within the current clipping rectangle *)(** Override for improved speed *)PROCEDURE Line*(CONST c: WMGraphics.Canvas;x0, y0, x1, y1 : LONGINT;  image: Raster.Image;VAR style:LONGINT;mode : LONGINT);VAR t, xi, mi, xf, mf, dt2 : LONGINT;	dw:LONGINT;BEGIN	IF image=NIL THEN RETURN; END;	dw:=image.width DIV 2;	IF y0 = y1 THEN (* horizontal case *)		IF x0 > x1 THEN t := x0; x0 := x1; x1 := t END;		FOR xi:=x0 TO x1 DO 			style:=BIT.LROT(style,1);			IF BIT.LAND(style,1) =1 THEN				c.DrawImage(xi-dw, y0-dw, image, mode);			END;		END;	ELSIF x0 = x1 THEN (* vertical case *)		IF y0 > y1 THEN t := y0; y0 := y1; y1 := t END;		FOR xi:=y0 TO y1 DO 			style:=BIT.LROT(style,1);			IF BIT.LAND(style,1) =1 THEN				c.DrawImage(x0-dw, xi-dw, image, mode);			END;		END;	ELSE (* general case *)		IF ABS(y1 - y0) > ABS(x1 - x0) THEN			IF y0 > y1 THEN t := y0; y0 := y1; y1 := t; t := x0; x0 := x1; x1 := t END;			xi := x0; xf :=	y0 - y1; mi := (x1 - x0) DIV (y1 - y0); mf := 2 * ( (x1 - x0) MOD (y1 - y0)); dt2 := 2 * (y1 - y0);			FOR t := y0 TO y1 DO				style:=BIT.LROT(style,1);				IF BIT.LAND(style,1) =1 THEN					c.DrawImage(xi-dw, t-dw, image, mode);				END;				INC(xi, mi); INC(xf, mf); 				IF xf > 0 THEN INC(xi); DEC(xf, dt2) END			END		ELSE			IF x0 > x1 THEN t := y0; y0 := y1; y1 := t; t := x0; x0 := x1; x1 := t END;			xi := y0; xf :=	x0 - x1; mi := (y1 - y0) DIV (x1 - x0); mf := 2 * ( (y1 - y0) MOD (x1 - x0)); dt2 := 2 * (x1 - x0);			FOR t := x0 TO x1 DO				style:=BIT.LROT(style,1);				IF BIT.LAND(style,1) =1 THEN					c.DrawImage(t-dw, xi-dw, image, mode);				END;								INC(xi, mi); INC(xf, mf); 				IF xf > 0 THEN INC(xi); DEC(xf, dt2) END			END		END	ENDEND Line;		END CanvasTools.(*Example of use:			canvas.SetFont(WMGraphics.GetFont("Oberon", 20, {WMGraphics.FontBold}));			canvas.DrawString(bild.width DIV 2 - 40, bild.height DIV 2 + 5 ,  "The End");			CreatePen(880,WMGraphics.Red,image);			Line(canvas,440,440,441,441,image,SHORT(0CCCCCCCCH),WMGraphics.ModeSrcOverDst);			CreatePen(20,WMGraphics.Red,image);			Line(canvas,10,10,301,301,image,SHORT(0CCCCCCCCH),WMGraphics.ModeSrcOverDst);			CreatePen(1,WMGraphics.Green,image);			Line(canvas,30,310,301,31,image,SHORT(0CCCCCCCCH),WMGraphics.ModeSrcOverDst);*)			